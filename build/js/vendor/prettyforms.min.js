PrettyForms=new function(){var t=function(t){var e=t.attr("id");return e&&"undefined"!=typeof CKEDITOR?CKEDITOR.instances[e]?!0:!1:void 0};this.templates={element_validations_container:'<div style="display:none;margin-top:10px" id="validation-error-{%}" class="alert alert-danger validation-errors-field" role="alert"></div>',element_validation_message:'<p><i class="fa fa-exclamation-circle" aria-hidden="true"></i>&nbsp;{%}</p>',form_validation_messages:'<div style="margin-bottom:10px" class="validation-errors alert alert-danger"></div>'},this.messages={server_error:"Что-то пошло не так на сервере, и он не смог обработать ваши данные. Мы постараемся исправить это как можно скорее. Пожалуйста, повторите попытку позже.",really:"Действительно выполнить действие?",really_agree:"Выполнить действие",really_title:"Вы уверены?",really_cancel:"Отмена",fix_and_retry:"Пожалуйста, исправьте ошибки в форме и повторите отправку.",rules:{notempty:"Поле не может быть пустым.",minlength:"Не менее {%} символов.",maxlength:"Не более {%} символов.",hasdomain:"Адрес должен начинаться с верного домена ({%})",isnumeric:"Поле может содержать только цифры.",isemail:"Должен быть введен корректный E-Mail",isurl:"Должен быть введен корректный URL-адрес сайта.",isdate:"Поле должно содержать дату",isphone:"Введён не корректный формат телефона",minint:"Минимальное вводимое число {%}",maxint:"Максимальное вводимое число {%}",intonly:"Можно ввести только число",passretry:"Должно быть равно полю с паролем",checked:"Должно быть помечено"}},this.Commands=new function(){this.handlers={},this.execute=function(t,e){this.handlers[t]&&this.handlers[t](e)},this.registerHandler=function(t,e){this.handlers[t]=e}},this.Validator=new function(){this.validation_rules={},this.validation_rules.notempty=function(t,e){return"radio"===t.attr("type")||"checkbox"===t.attr("type")?PrettyForms.form_container.find('input[name="'+t.attr("name")+'"]:checked').length>0:null===e?!1:0!==e.toString().length},this.validation_rules.minlength=function(t,e,r){return e.toString().length>=r},this.validation_rules.maxlength=function(t,e,r){return e.toString().length<=r},this.validation_rules.hasdomain=function(t,e,r){if(""==e||"(an empty string)"==e)return!0;r=r.split(",");for(var n in r)if(-1!=e.indexOf(r[n].trim()))return!0;return!1},this.validation_rules.isnumeric=function(t,e){return""==e||"(an empty string)"==e?!0:/^[0-9]+$/.test(e)},this.validation_rules.isemail=function(t,e){return""==e||"(an empty string)"==e?!0:/^.+@.+\..{2,9}$/.test(e)},this.validation_rules.isurl=function(t,e){return""==e||"(an empty string)"==e?!0:/^(http|ftp|https):\/\/.+\..{2,9}/.test(e)},this.validation_rules.isdate=function(t,e){return""==e||"(an empty string)"==e?!0:/^([0-9]{1,2})(\.|\/)([0-9]{1,2})(\.|\/)([0-9]{4,4})$/.test(e)?parseInt(RegExp.$1)<=31&&parseInt(RegExp.$3)<=12&&parseInt(RegExp.$5)<2500:!1},this.validation_rules.isphone=function(t,e){return""==e||"(an empty string)"==e||"(an empty string)"==e?!0:/^((8|\+7)?[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/.test(e)},this.validation_rules.minint=function(t,e,r){return""==e||"(an empty string)"==e?!0:parseInt(e)>=parseInt(r)},this.validation_rules.maxint=function(t,e,r){return""==e||"(an empty string)"==e?!0:parseInt(e)<=parseInt(r)},this.validation_rules.intonly=function(t,e){return""==e||"(an empty string)"==e?!0:/^[0-9]+$/.test(e)},this.validation_rules.passretry=function(t,e,r){return"undefined"==typeof r&&(r="password"),e===PrettyForms.form_container.find('input[name="'+r+'"]').val()},this.validation_rules.checked=function(t,e){return-1===t.attr("name").indexOf("[]")?t.is(":checked"):PrettyForms.form_container.find('input[name="'+t.attr("name")+'"]:checked').length>0},this.setValidator=function(t,e,r){this.validation_rules[t]=r,PrettyForms.messages.rules[t]=e},this.getMarkingElement=function(e){if("SELECT"===e.get(0).tagName){if($(e).data("select2"))return $(e).data("select2").$container;if($(e).data("chosen"))return $(e).data("chosen").container}return"TEXTAREA"===e.get(0).tagName&&t(e)&&(e=$(CKEDITOR.instances[$(e).attr("id")].container.$)),("checkbox"===e.attr("type")||"radio"===e.attr("type"))&&(e=e.parent().parent()),e},this.getElementErrorsContainer=function(t){var e=t.attr("name"),r=t.get(0);-1!==e.indexOf("[")&&PrettyForms.form_container.find('[name="'+e+'"]').map(function(t){this===r&&(e=e.replace("[","").replace("]","")+"-"+t)}),t=this.getMarkingElement(t);var n=PrettyForms.form_container.find("#validation-error-"+e);if(0===n.length){var a=t.closest(".input-group");a.length>0&&(t=a),t.after(PrettyForms.templates.element_validations_container.replace("{%}",e)),n=PrettyForms.form_container.find("#validation-error-"+e)}return n},this.markElementAsChecked=function(t){var e=this.getElementErrorsContainer(t);e.hide();var r=t.closest(".form-group");0!==r.length?(r.removeClass("has-warning"),"INPUT"===t.get(0).tagName&&r.find("span.glyphicon").remove()):this.getMarkingElement(t).removeClass("prettyforms-validation-error")},this.markElementAsErroneous=function(t,e,r){var n=this.getElementErrorsContainer(t);n.html(e).show(),r===!0&&t.addClass("validation-server-error");var a=t.closest(".form-group");0!==a.length?(a.addClass("has-feedback"),a.removeClass("has-success"),a.find("span.glyphicon.glyphicon-warning-sign.form-control-feedback").remove(),r!==!0&&(a.addClass("has-warning"),"INPUT"===t.get(0).tagName&&t.after('<span class="glyphicon glyphicon-warning-sign form-control-feedback" aria-hidden="true"></span>'))):this.getMarkingElement(t).addClass("prettyforms-validation-error"),n.stop().css("opacity","1").animate({opacity:.7},1500,"linear")},this.validate=function(e){var r=function(e){var r=e.attr("data-validation").split(";"),n="",a=!1;for(var i in r){var s=r[i].toString().trim();if(o=void 0,s.match(":")){var o=s.split(":");s=o[0].toString().trim(),o=o[1].toString().trim()}var l=PrettyForms.Validator.validation_rules[s];if("undefined"!=typeof l){var d=e.val();"TEXTAREA"===e.get(0).tagName&&t(e)&&(d=CKEDITOR.instances[e.attr("id")].getData());var m=l(e,d,o);if(m===!1){a=!0;var u=PrettyForms.messages.rules[s].replace("{%}",o);n+=PrettyForms.templates.element_validation_message.replace("{%}",u)}}}return a?n:!0};if(!(e.is(":visible")||e.data("chosen")||e.data("select2")||t(e)))return!0;if(!e.attr("data-validation"))return!0;if(e.hasClass("validation-server-error"))return!0;var n=r(e);return n===!0?(PrettyForms.Validator.markElementAsChecked(e),!0):(PrettyForms.Validator.markElementAsErroneous(e,n),!1)}},this.validation_errors_container=null,this.getInputData=function(t){if(this.setFormContainer(t),"undefined"!=typeof t&&""!==t){var e={},r=this.getInputsList(t),n=!0;return r.each(function(t){var r=$(this),a=void 0;if(void 0!=r.attr("name")&&"true"!==r.attr("data-dontsend")){switch(PrettyForms.Validator.validate(r)||(n&&PrettyForms.Validator.getMarkingElement(r).focus(),n=!1),-1!==r.attr("name").indexOf("[]")&&"undefined"==typeof e[r.attr("name")]&&(e[r.attr("name")]=[]),r.attr("type")){case"radio":case"checkbox":r.is(":checked")&&(a=r.val());break;default:a=r.val()}"TEXTAREA"===r.get(0).tagName&&"undefined"!=typeof CKEDITOR&&CKEDITOR.instances[r.attr("name")]&&(a=CKEDITOR.instances[r.attr("name")].getData()),"object"==typeof e[r.attr("name")]&&"undefined"!=typeof a?e[r.attr("name")].push(a):"undefined"!=typeof a&&(e[r.attr("name")]=a)}}),n?e:!1}},this.getInputsList=function(t){return $(t).find("input, select, textarea")},this.setFormContainer=function(t){this.form_container=$(t)},this.lastRequestData={},this.retryRequestsCount=0,this.sendData=function(t,e,r,n,a){n.attr("disabled","disabled").addClass("disabled"),setTimeout(function(){n.removeClass("disabled").attr("disabled",null)},1e4);var i=function(){n.removeClass("disabled").attr("disabled",null)},s=function(t){PrettyForms.getInputsList(t).map(function(){var t=$(this);"hidden"!==t.attr("type")&&t.val("")})},o=function(t){var e=!0;return t.map(function(t){t!==!0&&(e=!1)}),e};PrettyForms.lastRequestData={url:t,data:e,input_container_for_clear:r,input:n},void 0===a?PrettyForms.retryRequestsCount=0:PrettyForms.retryRequestsCount+=1,PrettyForms.retryRequestsCount>2||$.ajax({type:"POST",url:t,data:e,dataType:"json",success:function(t){i(),$.each(t,function(t,e){try{PrettyForms.Commands.execute(t,e)}catch(r){console.log("error in handling message",r)}});var e=[];e.push(!t.hasOwnProperty("validation_errors")),e.push(r!==!1),o(e)&&s(r)},error:function(t,e,r){i(),422===t.status?PrettyForms.Commands.execute("validation_errors",t):PrettyForms.Commands.execute("validation_errors",PrettyForms.messages.server_error)}})},this.sendDataAgain=function(){var t=PrettyForms.lastRequestData;this.sendData(t.url,t.data,t.input_container_for_clear,t.input,PrettyForms.retryRequestsCount)}},$(document).ready(function(){$("body").on("submit","form",function(){var t=PrettyForms.getInputData(this);return t===!1?(PrettyForms.validation_errors_container=$(this).find(".validation-errors"),PrettyForms.Commands.execute("validation_errors"),!1):!0}),$("body").on("click",".senddata",function(){var t=$(this),e=t.attr("href");if(("undefined"==typeof e||"#"===e)&&(e=t.attr("data-link")),"undefined"==typeof e){var r=t.closest("form");r.length>0&&(e=r.attr("action"))}"undefined"==typeof e&&(e=document.location.href);var n=$(t.attr("data-input"));if(0===n.length&&(n=t.closest("form")),!t.hasClass("disabled")&&"undefined"==typeof t.attr("disabled")){var a=function(){if(n.length>0){PrettyForms.setFormContainer(n),PrettyForms.validation_errors_container=n.find(".validation-errors"),0===PrettyForms.validation_errors_container.length&&(t.before(PrettyForms.templates.form_validation_messages),PrettyForms.validation_errors_container=n.find(".validation-errors")),PrettyForms.validation_errors_container.html("").hide(),$(n).find(".validation-server-error").removeClass("validation-server-error");var r=PrettyForms.getInputData(n);if(r===!1)PrettyForms.Commands.execute("validation_errors");else{var a=!1;"true"===t.attr("data-clearinputs")&&(a=n),PrettyForms.sendData(e,r,a,t)}}else PrettyForms.validation_errors_container=$(""),r={},PrettyForms.setFormContainer(t.parent()),PrettyForms.sendData(e,r,!1,t)};if(t.hasClass("really")){var i=PrettyForms.messages.really;if(t.attr("data-really-text")&&(i=t.attr("data-really-text")),"undefined"!=typeof swal){var s=t.attr("data-really-text-btn")?t.attr("data-really-text-btn"):PrettyForms.messages.really_agree;swal({title:PrettyForms.messages.really_title,text:i,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:s,cancelButtonText:PrettyForms.messages.really_cancel,closeOnConfirm:!0,allowOutsideClick:!1},function(){a()})}else{if(!confirm(i))return!1;a()}}else a()}return!1}),PrettyForms.Commands.registerHandler("validation_errors",function(t){if(PrettyForms.validation_errors_container.length>0){var e=PrettyForms.messages.fix_and_retry;if("undefined"!=typeof t)if("string"==typeof t)PrettyForms.validation_errors_container.html(t).show();else{var r=!1;$.each(t.responseJSON,function(t,n){var a=PrettyForms.form_container.find('[name="'+t+'"]');if(a.length>0){var i="";n.map(function(t){var r=PrettyForms.templates.element_validation_message.replace("{%}",t);i+=r,e+=r}),PrettyForms.Validator.markElementAsErroneous(a,i,!0),r===!1&&(PrettyForms.Validator.getMarkingElement(a).focus(),r=!0)}}),PrettyForms.validation_errors_container.html(e).show()}else PrettyForms.validation_errors_container.html(e).show()}}),PrettyForms.Commands.registerHandler("redirect",function(t){"undefined"==typeof t&&(t=document.location.href),document.location.href=t}),PrettyForms.Commands.registerHandler("refresh",function(){document.location.href=document.location.href}),PrettyForms.Commands.registerHandler("nothing",function(){}),PrettyForms.Commands.registerHandler("success",function(t){"undefined"!=typeof swal?swal(t.title,t.text,"success"):alert(t.title+"\n\n"+t.text)}),PrettyForms.Commands.registerHandler("warning",function(t){"undefined"!=typeof swal?swal(t.title,t.text,"warning"):alert(t.title+"\n\n"+t.text)}),PrettyForms.Commands.registerHandler("info",function(t){"undefined"!=typeof swal?swal(t.title,t.text,"info"):alert(t.title+"\n\n"+t.text)}),PrettyForms.Commands.registerHandler("error",function(t){"undefined"!=typeof swal?swal(t.title,t.text,"error"):alert(t.title+"\n\n"+t.text)})});
//# sourceMappingURL=prettyforms.min.js.map